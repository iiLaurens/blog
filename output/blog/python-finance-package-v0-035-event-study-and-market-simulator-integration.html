<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Python Finance Package v0.035 - Event study and market simulator Integration - Laurens' geeky adventures</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.laurens.xyz/blog/python-finance-package-v0-035-event-study-and-market-simulator-integration.html">

        <meta name="author" content="Daniel Rodriguez" />
        <meta name="keywords" content="Coursera,Finance,Pandas,Python,Computational investing" />
        <meta name="description" content="Ok, here come the first &#34;Real Life&#34; example. As I mention on previous posts my finance knowledge is mostly null so I cannot say this can be used on real life but what I found playing with the utils I have created is very interesting. If anyone use this techniques ..." />

        <meta property="og:site_name" content="Laurens' geeky adventures" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Python Finance Package v0.035 - Event study and market simulator Integration"/>
        <meta property="og:url" content="http://blog.laurens.xyz/blog/python-finance-package-v0-035-event-study-and-market-simulator-integration.html"/>
        <meta property="og:description" content="Ok, here come the first &#34;Real Life&#34; example. As I mention on previous posts my finance knowledge is mostly null so I cannot say this can be used on real life but what I found playing with the utils I have created is very interesting. If anyone use this techniques ..."/>
        <meta property="article:published_time" content="2012-12-28" />
            <meta property="article:section" content="12" />
            <meta property="article:tag" content="Coursera" />
            <meta property="article:tag" content="Finance" />
            <meta property="article:tag" content="Pandas" />
            <meta property="article:tag" content="Python" />
            <meta property="article:tag" content="Computational investing" />
            <meta property="article:author" content="Daniel Rodriguez" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.laurens.xyz/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="http://blog.laurens.xyz/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.laurens.xyz/theme/css/pygments/zenburn.css" rel="stylesheet">
    <link href="http://blog.laurens.xyz/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.laurens.xyz/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.laurens.xyz/" class="navbar-brand">
Laurens' geeky adventures            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li ><a href="http://blog.laurens.xyz/tags.html">Tags</a></li>
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.laurens.xyz/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.laurens.xyz/blog/python-finance-package-v0-035-event-study-and-market-simulator-integration.html"
                       rel="bookmark"
                       title="Permalink to Python Finance Package v0.035 - Event study and market simulator Integration">
                        Python Finance Package v0.035 - Event study and market simulator Integration
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2012-12-28T15:00:00+01:00"> 28-12-2012</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://blog.laurens.xyz/tags/coursera.html">Coursera</a>
        /
	<a href="http://blog.laurens.xyz/tags/finance.html">Finance</a>
        /
	<a href="http://blog.laurens.xyz/tags/pandas.html">Pandas</a>
        /
	<a href="http://blog.laurens.xyz/tags/python.html">Python</a>
        /
	<a href="http://blog.laurens.xyz/tags/computational-investing.html">Computational investing</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Ok, here come the first "Real Life" example. As I mention on previous
posts my finance knowledge is mostly null so I cannot say this can be
used on real life but what I found playing with the utils I have created
is very interesting.</p>
<p>If anyone use this techniques and win/lose money I would love to hear :P
Also if anyone find discrepancies on the results <strong>please</strong> tell me.</p>
<h2>Changes since last time</h2>
<ol>
<li><span style="line-height:13px;">Bug Fixes on Multiple Event Study:
    Missing values are now filled: forward and then backwards.</span></li>
<li>Multiple Event Studies: Graph with error bars (std)</li>
<li>Integration between the Event Study Finder and Market Simulator</li>
</ol>
<h2>Example</h2>
<ol>
<li>Use the S&amp;P 500 symbols from 2012</li>
<li>Look in all 2011 for events when the value of the stock went below
    $5</li>
<li>Discover how to use this opportunity to invest on the equities</li>
<li>Simulate if we would make some money from that</li>
</ol>
<h3>1. Setup</h3>
<p>In [1]: Imports</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">finance.utils</span> <span class="kn">import</span> <span class="n">BasicUtils</span>
<span class="kn">from</span> <span class="nn">finance.utils</span> <span class="kn">import</span> <span class="n">FileManager</span>
<span class="kn">from</span> <span class="nn">finance.utils</span> <span class="kn">import</span> <span class="n">ListUtils</span>
<span class="kn">from</span> <span class="nn">finance.evtstudy</span> <span class="kn">import</span> <span class="n">EventFinder</span>
<span class="kn">from</span> <span class="nn">finance.evtstudy</span> <span class="kn">import</span> <span class="n">MultipleEvents</span>
<span class="kn">from</span> <span class="nn">finance.sim</span> <span class="kn">import</span> <span class="n">MarketSimulator</span>
</pre></div>


<p>In [2]: Download all the information on 2011 of all S&amp;P 500 equities on
2012</p>
<div class="highlight"><pre><span></span><span class="n">SP500_2012</span> <span class="o">=</span> <span class="n">ListUtils</span><span class="o">.</span><span class="n">SP500</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2012</span><span class="p">)</span>
<span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">()</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">SP500_2012</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</pre></div>


<p>Out [2]:</p>
<div class="highlight"><pre><span></span>498
</pre></div>


<h3>2. Event: Went Below 5 - One event per Equity</h3>
<p>In [5]: Look for events</p>
<div class="highlight"><pre><span></span><span class="n">evtf</span> <span class="o">=</span> <span class="n">EventFinder</span><span class="p">()</span>
<span class="n">evtf</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">SP500_2012</span>
<span class="n">evtf</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start</span>
<span class="n">evtf</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">end</span>
<span class="n">evtf</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">evtf</span><span class="o">.</span><span class="n">went_below</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">evtf</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>


<p>In [6]:</p>
<div class="highlight"><pre><span></span><span class="n">evtf</span><span class="o">.</span><span class="n">num_events</span>
</pre></div>


<p>Out [6]: 5 Events where found</p>
<div class="highlight"><pre><span></span>5
</pre></div>


<p>In [7]: Analyse the 5 Events</p>
<div class="highlight"><pre><span></span><span class="n">mevt</span> <span class="o">=</span> <span class="n">MultipleEvents</span><span class="p">()</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">evtf</span><span class="o">.</span><span class="n">list</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">market</span> <span class="o">=</span> <span class="s1">&#39;SPY&#39;</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">lookback_days</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">lookforward_days</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">estimation_period</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">mevt</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>In [8]: Graph the mean cumulative abnornal return</p>
<div class="highlight"><pre><span></span><span class="n">mevt</span><span class="o">.</span><span class="n">mean_cumulative_abnormal_return</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>


<p><img alt="Mean Cumulative Abnormal Return" src="/images/blog/2012/12/finance035/mean_car.png" title="Mean Cumulative Abnormal Return" /></p>
<p>The graph tell us that in average after the event (day 0) the return
goes up, but what about the risk?</p>
<p>In [9]: Print the Cumulative Abnormal Return with Error Bars</p>
<div class="highlight"><pre><span></span><span class="n">mevt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="Mean Cumulative Abnormal Return with error bars" src="/images/blog/2012/12/finance035/mean_car_error_bars.png" title="Mean Cumulative Abnormal Return with error bars" /></p>
<p>Ok, the graph tell us that the risk is going up as the time passes, this
was expected.
Since we are looking the data in 2011 we can see what happen in
reality.</p>
<p>We use the market simulator but we create the orders from the event
list.
The instructions are:</p>
<ol>
<li>On the event day: Buy 100 shares</li>
<li>20 days after the event: Sell the 100 Shares</li>
<li>Initial cash = $1000</li>
</ol>
<p>In [10]: Use the market simulator</p>
<div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">MarketSimulator</span><span class="p">(</span><span class="s1">&#39;./data&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Adj</span> <span class="n">Close</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="n">sim</span><span class="o">.</span><span class="n">initial_cash</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sim</span><span class="o">.</span><span class="n">create_trades_from_event</span><span class="p">(</span><span class="n">evtf</span><span class="o">.</span><span class="n">list</span><span class="p">,</span> <span class="n">eventDayAction</span><span class="o">=</span><span class="s1">&#39;Buy&#39;</span><span class="p">,</span>
<span class="n">eventDayShares</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">actionAfter</span><span class="o">=</span><span class="s1">&#39;Sell&#39;</span><span class="p">,</span> <span class="n">daysAfter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sharesAfter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
<span class="n">sim</span><span class="o">.</span><span class="n">trades</span>
</pre></div>


<p>Out [10]: This are the trades generated by the Simulator</p>
<div class="highlight"><pre><span></span>symbol action  num_of_shares
2011-08-08   HBAN    Buy     100
2011-09-06   HBAN    Sell    100
2011-09-22   GNW     Buy     100
2011-10-03   AMD     Buy     100
2011-10-20   GNW     Sell    100
2011-10-31   AMD     Sell    100
2011-11-23   HCBK    Buy     100
2011-12-19   BAC     Buy     100
2011-12-22   HCBK    Sell    100
2012-01-19   BAC     Sell    100
</pre></div>


<p>In [11]: Graph of the portfolio value:</p>
<div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">BasicUtils</span><span class="o">.</span><span class="n">total_return</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">portfolio</span><span class="p">)</span>
</pre></div>


<p>Out [11]:</p>
<div class="highlight"><pre><span></span>0.501
</pre></div>


<p>I obtain 5 events and a total return of 0.501 with just 10 trades.</p>
<p><img alt="Portfolio value for the events" src="/images/blog/2012/12/finance035/mean_car.png" title="Portfolio value for the events" /></p>
<h3>3. Event: Went below 5 - more than one event per equity</h3>
<p>From what I saw on the events when one event occurred more events
occurred soon (less than 20 days later), that didn't look good for me
that's why I tried first with no repeating events. But from my
<a href="https://class.coursera.org/compinvesting1-2012-001/class/index" title="Computational Investing">computational investing</a> course I notice that they use all the events
so I tried that to: The code is the same just change this on the event
finder:</p>
<div class="highlight"><pre><span></span><span class="n">evtf</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">oneEventPerEquity</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>On this case I found 21 events with a total return of: 0.684; chart:</p>
<p><img alt="Portfolio value for the events" src="/images/blog/2012/12/finance035/portfolio2.png" title="Portfolio value for the events" /></p>
<h2>Conlusion</h2>
<p>Also if anyone find discrepancies on the results <strong>please</strong> tell me.</p>
<p>First, I obtain a total return of 0.501 with just 10 trades; that means
that the final value of the portfolio was $1,501. When I saw this I was
amazed, just buying shares of very cheap stocks (100 stocks @ &lt;$5 =
500) and then selling those stocks 20 days later was possible to make
$501 in just 6 months. Even more if use the second event study.</p>
<p>Second, the utils works very well together and with a considerable
amount of data, not just 2 equities as before.</p>
<p>Third, <strong>I am rich! weee!</strong> Ok no, not really. But the results are
<strong>very</strong> interesting, at least I was amazed, I never believe of finding
a return greater than 0.5.</p>
<p>The code + the complete example is on GitHub: <a href="https://github.com/danielfrg/PythonFinance" title="Python Finance Package">PythonFinance</a></p>
<p>This is <strong>far</strong> from the end but the <a href="https://class.coursera.org/compinvesting1-2012-001/class/index" title="Computational Investing">computational investing</a> course
ends with this example so I have no longer a source of inspiration, I am
searching for book on quantitative finance to keep learning and
developing the package.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

                    var disqus_identifier = 'python-finance-package-v0-035-event-study-and-market-simulator-integration';
                var disqus_url = 'http://blog.laurens.xyz/blog/python-finance-package-v0-035-event-study-and-market-simulator-integration.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2013 Laurens
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.laurens.xyz/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.laurens.xyz/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.laurens.xyz/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>