<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Python to replace SAS Enterprise Miner (basic) - Laurens' geeky adventures</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="../blog/python-replace-sas.html">

        <meta name="author" content="Daniel Rodriguez" />
        <meta name="keywords" content="Pandas,Python,SAS,scikit-learn" />
        <meta name="description" content="Why? The last fall (2012) I took a class called Business Intelligence (at UT Dallas) which is the same as Data Mining or Machine Learning to business people. On that class they taught us to use SAS Enterprise Miner. I used it but I hate to use it. First of ..." />

        <meta property="og:site_name" content="Laurens' geeky adventures" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Python to replace SAS Enterprise Miner (basic)"/>
        <meta property="og:url" content="../blog/python-replace-sas.html"/>
        <meta property="og:description" content="Why? The last fall (2012) I took a class called Business Intelligence (at UT Dallas) which is the same as Data Mining or Machine Learning to business people. On that class they taught us to use SAS Enterprise Miner. I used it but I hate to use it. First of ..."/>
        <meta property="article:published_time" content="2013-01-02" />
            <meta property="article:section" content="01" />
            <meta property="article:tag" content="Pandas" />
            <meta property="article:tag" content="Python" />
            <meta property="article:tag" content="SAS" />
            <meta property="article:tag" content="scikit-learn" />
            <meta property="article:author" content="Daniel Rodriguez" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="../theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../theme/css/pygments/zenburn.css" rel="stylesheet">
    <link href="../theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../" class="navbar-brand">
Laurens' geeky adventures            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li ><a href="../tags.html">Tags</a></li>
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../blog/python-replace-sas.html"
                       rel="bookmark"
                       title="Permalink to Python to replace SAS Enterprise Miner (basic)">
                        Python to replace SAS Enterprise Miner (basic)
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-01-02T17:00:00+01:00"> 02-01-2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="../tags/pandas.html">Pandas</a>
        /
	<a href="../tags/python.html">Python</a>
        /
	<a href="../tags/sas.html">SAS</a>
        /
	<a href="../tags/scikit-learn.html">scikit-learn</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2>Why?</h2>
<p>The last fall (2012) I took a class called Business Intelligence (at
UT Dallas) which is the same as Data Mining or Machine Learning
to business people. On that class they taught us to use SAS Enterprise
Miner. I used it but I <strong>hate</strong> to use it. First of all I had to <strong>pay</strong>
for it: like $100 dollars, not much because the University has an
arrangement with SAS but I had to pay that again soon, and I have to pay
a lot of money to use it without the University help. Second, is
<strong>slow</strong> as hell, I was going mad using that piece of $%#\^ :-P. And
don't get me wrong, the software is "good", but is not for me.</p>
<p>That is the reason why during this time I learn the basics of R (from
<a href="http://coursera.org" title="Coursera">coursera</a>) and python data analysis packages, mainly pandas. The
objective on this case is to use Python to replace the functionality I
learned this semester of <a href="http://www.sas.com/technologies/analytics/datamining/miner/" title="SAS Enterprise Miner">SAS Enterprise Miner</a>. I already knew basic
the basics of pandas, numpy and scipy but I still had on my ToDo list
learn <a href="http://scikit-learn.org/stable/" title="Scikit-learn">Scikit-learn</a>.</p>
<h2>What I wanted to do</h2>
<p>I wanted to replace the functionality I learned this semester from SAS
EM, that is, the very basics:</p>
<ol>
<li>Import data</li>
<li>Basic data transformation</li>
<li>Model training</li>
<li>Model comparison</li>
<li>Model scoring</li>
</ol>
<p>So I needed to do the same with iPython, Pandas, Scikit-learn and
Matplotlib. On SAS EM a basic project looks like this:</p>
<p><img alt="SAS EM Basic Project" src="/images/blog/2013/01/replace-sas-python/screenshot-from-2012-12-31-200944.png" title="SAS EM Basic Project" /></p>
<h2>Installation</h2>
<p>I already had installed iPython, pandas and numpy but not Scikit-learn,
and since I am using Python 3 (3.2.3) I had to compile scikit-learn from
the last development source code: as easy as download the last version
from <a href="https://github.com/scikit-learn/scikit-learn" title="Scikit-learn github">Github</a> and ran <code>python setup.py install</code></p>
<h2>Example</h2>
<p>The data I used is the same I used for a project on the Business
Intelligence class, so I could compare the results I obtained from SAS.</p>
<p>In a tweet the project is: The data is from people who order products
from a catalog, and the idea was to help the company to target the
customers who receive the catalogs in order to reduce expenses. There
are two <code>CSV</code> files of 2000 records each, one for training and one for
testing. The available data is:</p>
<ol>
<li>NGIF: number of orders in the 24 months</li>
<li>RAMN: Total order amounts in dollars in the last 24 months</li>
<li>LASG: Amount of last order</li>
<li>LASD: Date of last order (you may need to convert it to number of
    months elapsed to 01/01/2007)</li>
<li>RFA1: Frequency of order<ol>
<li>1=One order in the last 24 months</li>
<li>2=Two orders in the last 24 months</li>
<li>3=Three orders in the last 24 months</li>
<li>4=Four or more orders in the last 24 months</li>
</ol>
</li>
<li>RFA2: Order amount category (as defined by the firm) of the last
    order<ol>
<li>1=$0.01 - $1.99</li>
<li>2=$2.00 - $2.99</li>
<li>3=$3.00 e - $4.99</li>
<li>4=$5.00 - $9.99</li>
<li>5=$10.00 - $14.99</li>
<li>6=$15.00 - $24.99</li>
<li>7=$25.00 and above</li>
</ol>
</li>
<li>Money: money amount eventually a customer will spend on next order
    (if she places orders), only available for “testing”.</li>
<li>Order: Actual response (1: response, 0: no response)</li>
</ol>
<p>The file looks like this:</p>
<div class="highlight"><pre><span></span>CustomerID,NGIF,RAMN,LASG,LASD,RFA1,RFA2,Order
1,2,30,20,200503,1,6,1
2,25,207,20,200503,1,6,0
3,5,52,15,200503,1,6,0
4,11,105,15,200503,1,6,0
5,2,32,17,200503,1,6,0
       ...
</pre></div>


<p>The good part is that the data is clean, everything is a number and
there are no missing values. This is far from real, but for a first
example is perfect.</p>
<h3>1. Import data</h3>
<p>As simple as:</p>
<div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;training.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;testing.csv&#39;</span><span class="p">)</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span>
</pre></div>


<h3>2. Data transform</h3>
<p>Is necesary to convert the LASG (Date of last order) to a normal number;
I decide to use MSLO (number of Months Since Last Order). Knowing that
the data is from February, 2007 the equation to convert I use is:
<code>MSLO = 12*(2007 - YEAR) - MONTH + 2</code>. On python it translates to:</p>
<div class="highlight"><pre><span></span><span class="n">MSLO</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;LASD&#39;</span><span class="p">]</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2007</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">MSLO</span> <span class="o">=</span> <span class="n">MSLO</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>


<p>Then just need to remove the LASD column and add the MSLO data:</p>
<div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;LASD&#39;</span><span class="p">]</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;MSLO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSLO</span>
</pre></div>


<h3>3. Model Training</h3>
<p>This is covered by scikit-learn, they have tons of models, from Decision
Tree to <strong>a lot</strong> of models, seriously. For this example I use the
always good Decision Tree also Support Vector Machine and Naive Bayes.</p>
<div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s1">&#39;NGIF&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMN&#39;</span><span class="p">,</span> <span class="s1">&#39;LASG&#39;</span><span class="p">,</span> <span class="s1">&#39;MSLO&#39;</span><span class="p">,</span> <span class="s1">&#39;RFA1&#39;</span><span class="p">,</span>
<span class="s1">&#39;RFA2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Order&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<span class="n">svm</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">export_graphviz</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="s1">&#39;tree.dot&#39;</span><span class="p">)</span>

<span class="n">gnb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">gnb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
</pre></div>


<h3>4. Model Scoring/Comparison</h3>
<p>Scikit-learn comes with Confusion Matrix and ROC Chart included:</p>
<div class="highlight"><pre><span></span><span class="n">tree_score</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">svm_score</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">gnb_score</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">tree_cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">tree_score</span><span class="p">)</span>
<span class="n">svm_cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">svm_score</span><span class="p">)</span>
<span class="n">gnb_cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">gnb_score</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># tree</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">1365</span><span class="p">,</span> <span class="mi">67</span><span class="p">],</span> <span class="p">[</span> <span class="mi">506</span><span class="p">,</span> <span class="mi">62</span><span class="p">]])</span>
<span class="c1"># svm</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">1362</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="p">[</span> <span class="mi">531</span><span class="p">,</span> <span class="mi">37</span><span class="p">]])</span>
<span class="c1">#gnb</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">1196</span><span class="p">,</span> <span class="mi">236</span><span class="p">],</span> <span class="p">[</span> <span class="mi">406</span><span class="p">,</span> <span class="mi">162</span><span class="p">]])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">tree_probas</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">svm_probas</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">gnb_probas</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">tree_fpr</span><span class="p">,</span> <span class="n">tree_tpr</span><span class="p">,</span> <span class="n">tree_thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span>
<span class="n">tree_probas</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">svm_fpr</span><span class="p">,</span> <span class="n">svm_tpr</span><span class="p">,</span> <span class="n">svm_thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span>
<span class="n">svm_probas</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">gnb_fpr</span><span class="p">,</span> <span class="n">gnb_tpr</span><span class="p">,</span> <span class="n">gnb_thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span>
<span class="n">gnb_probas</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tree_fpr</span><span class="p">,</span> <span class="n">tree_tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tree&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">svm_fpr</span><span class="p">,</span> <span class="n">svm_tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SVM&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gnb_fpr</span><span class="p">,</span> <span class="n">gnb_tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GNB&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Receiver operating characteristic&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="ROC Comparison" src="/images/blog/2013/01/replace-sas-python/roc.png" title="ROC Comparison" /></p>
<h2>Conclusion</h2>
<p>With this quick example I was able to get most of the results I learned
on my BI class. The analysis of the results is more important but not
the objective of this post. Enterprise Miner produces a lot of results
but they are useless unless you understand them, is better to get few
results and use understand them correctly. Other chart I learned was the
Lift chart but scikit-learn does not have this option.</p>
<p>I was able to get the results a <strong>lot</strong> quicker with Python than with
SAS EM, for this project it took me like 4 or 5 hours with SAS EM and
less than 1 hour on Python.</p>
<p>The complete iPython notebook (also visible <a href="http://nbviewer.ipython.org/urls/raw.github.com/dfrodriguez143/PythonDataAnalysisExamples/master/catalog-marketing/catalog-marketing.ipynb">here</a>) and data is
available on Github: <a href="https://github.com/dfrodriguez143/PythonDataAnalysisExamples/tree/master/catalog-marketing" title="Catalog Marketing">Data Analysis Examples Python - Catalog
Marketing</a>.</p>
<p>Note : I know this is the most very basic example of Machine Learning on
Python, more complex examples will come later.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

                    var disqus_identifier = 'python-replace-sas';
                var disqus_url = '../blog/python-replace-sas.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2013 Laurens
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>