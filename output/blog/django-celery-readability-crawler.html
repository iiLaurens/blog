<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Django + Celery + Readability = Python relevant content crawler - Laurens' geeky adventures</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.laurens.xyz/blog/django-celery-readability-crawler.html">

        <meta name="author" content="Daniel Rodriguez" />
        <meta name="keywords" content="πython,Django,Celery,Readability,Crawling" />
        <meta name="description" content="I have written a few posts about crawling content from the web. Mainly because I know the power of data and the biggest data source in the world is the web, Google knew it and we all now how they are doing. In my last post I wrote about crawling ..." />

        <meta property="og:site_name" content="Laurens' geeky adventures" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Django + Celery + Readability = Python relevant content crawler"/>
        <meta property="og:url" content="http://blog.laurens.xyz/blog/django-celery-readability-crawler.html"/>
        <meta property="og:description" content="I have written a few posts about crawling content from the web. Mainly because I know the power of data and the biggest data source in the world is the web, Google knew it and we all now how they are doing. In my last post I wrote about crawling ..."/>
        <meta property="article:published_time" content="2013-09-11" />
            <meta property="article:section" content="09" />
            <meta property="article:tag" content="πython" />
            <meta property="article:tag" content="Django" />
            <meta property="article:tag" content="Celery" />
            <meta property="article:tag" content="Readability" />
            <meta property="article:tag" content="Crawling" />
            <meta property="article:author" content="Daniel Rodriguez" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.laurens.xyz/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="http://blog.laurens.xyz/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.laurens.xyz/theme/css/pygments/zenburn.css" rel="stylesheet">
    <link href="http://blog.laurens.xyz/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.laurens.xyz/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.laurens.xyz/" class="navbar-brand">
Laurens' geeky adventures            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li ><a href="http://blog.laurens.xyz/tags.html">Tags</a></li>
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.laurens.xyz/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.laurens.xyz/blog/django-celery-readability-crawler.html"
                       rel="bookmark"
                       title="Permalink to Django + Celery + Readability = Python relevant content crawler">
                        Django + Celery + Readability = Python relevant content crawler
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-09-11T00:00:00+02:00"> 11-09-2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://blog.laurens.xyz/tags/python.html">πython</a>
        /
	<a href="http://blog.laurens.xyz/tags/django.html">Django</a>
        /
	<a href="http://blog.laurens.xyz/tags/celery.html">Celery</a>
        /
	<a href="http://blog.laurens.xyz/tags/readability.html">Readability</a>
        /
	<a href="http://blog.laurens.xyz/tags/crawling.html">Crawling</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I have written a <a href="{filename}../08/relevant-content-blog-crawler.ipynb">few</a> <a href="http://blog.laurens.xyz/blog/nba-scraping-data.html">posts</a>
about crawling content from the web. Mainly because I know the power of data
and the biggest data source in the world is the web, Google knew it and we all now how they are
doing. In my <a href="{filename}../08/relevant-content-blog-crawler.ipynb">last post</a> I wrote about crawling relevant content
from blogs; It worked but what if I want an admin UI to control the crawling. What if I just put
the crawler in an EC2 instance and just call it when I need to crawl.</p>
<p>The solution was pretty simple thanks to some python projects.
I just needed to move from <a href="http://www.sqlalchemy.org/">sqlalchemy</a> to
<a href="https://docs.djangoproject.com/en/1.5/">django</a> ORM, create a few <a href="http://celeryproject.org/">celery</a> tasks
and use <a href="https://github.com/celery/django-celery/">django-celery</a> to have a pretty UI of the tasks.</p>
<p>I was amazed on how easy it was to integrate celery with django. I just created a few tasks to
actually crawl blogs (I already had the code from my last post) and create some
<a href="https://docs.djangoproject.com/en/dev/ref/contrib/admin/actions/">django actions</a> so the I can create
tasks by demand.</p>
<h2>Tasks</h2>
<p>The <code>tasks.py</code> is below. Depending on if the blog is wordpress or blogspot I crawl the blog feed
differently, that way I can crawl not only the 10 most recent posts but the whole blog. So I created a few tasks
to discover the type of the blog. Then based on the type discover the feed URL to crawl.</p>
<p>For example wordpress blogs generally have the feed under: <code>http://mywordpressblog.com/feed/</code>.
This gives me only 10 posts if I want more I can request: <code>http://mywordpressblog.com/feed/?paged=2</code>
and that will give me a feed from post 11 to 20. Do this recursively and you get all the posts of the blog.
Something similar happens with blogspot.</p>
<p>Finally I created some simple tasks to convert the post content to lower-case and word-tokenization using
a new but pretty amazing library called <a href="https://github.com/sloria/TextBlob">TextBlob</a></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">apps.blog_crawler</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">apps.blog_crawler.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Post</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">readability</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">text.blob</span> <span class="kn">import</span> <span class="n">TextBlob</span>


<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">lowerize</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>

    <span class="n">post</span><span class="o">.</span><span class="n">cleaned</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">cleaned</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">word_tokenize</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">cleaned</span><span class="p">)</span>

    <span class="n">post</span><span class="o">.</span><span class="n">cleaned</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">discover_type</span><span class="p">(</span><span class="n">blog_id</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>

    <span class="n">kind</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">discover_kind</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">discover_feed</span><span class="p">(</span><span class="n">blog_id</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">blog</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">discover_kind</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">blog</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">discover_feed</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">blog</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">feed</span> <span class="o">=</span> <span class="n">feed</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">crawl</span><span class="p">(</span><span class="n">blog_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>

    <span class="c1"># Readability API</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">readability</span><span class="o">.</span><span class="n">ParserClient</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">READABILITY_PARSER_TOKEN</span><span class="p">)</span>

    <span class="c1"># Create and start logger</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_logger</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>

    <span class="n">post_list</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_posts</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span> <span class="n">blog</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">n_posts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">post_list</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;{0} ({1})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">n_posts</span><span class="p">))</span>

    <span class="c1"># Start actual crawl</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">post_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;{0}/{1} Already exists: {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n_posts</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser_response</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_article_content</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">parser_response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">])</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
                <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;{0}/{1} FAIL: {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_posts</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;{0}/{1} OK: {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_posts</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.6</span><span class="p">)</span>
</pre></div>


<h2>Django Admin</h2>
<p>Then just needed to create a django app with some actions to call the celery tasks. This allows me to have the
worker on a micro instance on EC2 and just queue the tasks using celery.
I used <a href="http://www.rabbitmq.com/">rabbitmq</a> as the broker.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">apps.blog_crawler</span> <span class="kn">import</span> <span class="n">tasks</span>


<span class="k">class</span> <span class="nc">BlogAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;last_crawl&#39;</span><span class="p">]</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;discover_type&#39;</span><span class="p">,</span> <span class="s1">&#39;discover_feed&#39;</span><span class="p">,</span> <span class="s1">&#39;crawl&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">discover_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">discover_type</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Task(s) created&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">discover_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">discover_feed</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Task(s) created&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">crawl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">crawl</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Task(s) created&#39;</span><span class="p">)</span>

    <span class="n">discover_type</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Discover the type of the blog(s)&#39;</span>
    <span class="n">discover_feed</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Discover the feed of the blog(s)&#39;</span>
    <span class="n">crawl</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Crawls the selected blog(s)&#39;</span>


<span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;word_tokenize&#39;</span><span class="p">,</span> <span class="s1">&#39;lowerize&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">post</span><span class="o">.</span><span class="n">cleaned</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">content</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Content copied&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">word_tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">word_tokenize</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Task(s) created&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lowerize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">lowerize</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Task(s) created&#39;</span><span class="p">)</span>

    <span class="n">copy</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Copy the crawled content to cleaned&#39;</span>
    <span class="n">word_tokenize</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Tockenize by words&#39;</span>
    <span class="n">lowerize</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;Lower-case the cleaned content&#39;</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">BlogAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</pre></div>


<h2>UI</h2>
<p>The admin UI, using the <a href="http://djangosuit.com/">beautiful django suit</a>, looks like this.</p>
<p><img alt="Home admin UI" src="/images/blog/2013/09/django-crawler/home_admin.png" title="Home admin UI" /></p>
<p>Note: don't ask me why is I am using that blog to test</p>
<p><img alt="Blog admin UI" src="/images/blog/2013/09/django-crawler/blogs_admin.png" title="Blogs admin UI" /></p>
<p><img alt="Posts admin UI" src="/images/blog/2013/09/django-crawler/posts_admin.png" title="Posts admin UI" /></p>
<p>You can see the running tasks, or previous tasks.</p>
<p><img alt="Tasks admin UI" src="/images/blog/2013/09/django-crawler/tasks.png" title="Tasks admin UI" /></p>
<h2>Conclusion</h2>
<p>I was pretty happy with this result. With very little effort I was able to build a quite complex
system. PostgreSQL for the database, rabbitmq + celery for message/tasks queuing and finally
Django for the UI. I can even create some</p>
<p>I consider this an example of why I choose python and its amazing community. The people working on
these projects are brilliant and are doing an amazing job. Focusing on building the basic tools so
people can build amazing stuff faster and easier than ever.</p>
<p>Some stuff I want to try next if real live allows me to is:</p>
<ul>
<li><a href="http://haystacksearch.org/">Haystack</a> + Solr for search</li>
<li>MongoDB instead of Postgres. Apparently is <em>really</em> easy using <a href="https://github.com/django-nonrel/mongodb-engine">django-nonrel</a></li>
</ul>
<p>As usual everything is on github: <a href="https://github.com/danielfrg/django_crawler">django-crawler</a></p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

                    var disqus_identifier = 'django-celery-readability-crawler';
                var disqus_url = 'http://blog.laurens.xyz/blog/django-celery-readability-crawler.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2013 Laurens
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.laurens.xyz/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.laurens.xyz/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.laurens.xyz/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>